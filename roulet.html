<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BOZHEMAN ROULETTE</title>
  <link rel="stylesheet" href="roulette.css" />
</head>
<body>
  <!-- ===== TOP BAR ===== -->
  <header class="top-bar">
    <h1>ROULETTE&nbsp;OF&nbsp;BOZHEMAN</h1>
    <div class="balance">–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span> BMAN</div>
  </header>

  <!-- ===== MAIN LAYOUT ===== -->
  <div class="layout">
    <!-- WHEEL AREA -->
    <div class="wheel-wrapper">
      <div class="pointer"></div>
      <div class="wheel" id="wheel"></div>
      <div class="ball" id="ball"></div>
    </div>

    <!-- BET BOARD -->
    <div class="bet-board" id="bet-board"></div>
  </div>

  <!-- RESULT / MESSAGE -->
  <div class="result-block">
    <div id="result-display" class="number-display"></div>
    <div id="message" class="message"></div>
    <button id="buy-access" onclick="window.location.href='https://t.me/bozheman';">üíé –ö–£–ü–ò–¢–¨ –ü–†–û–•–û–î</button>
  </div>

  <!-- CHIP ROW + SPIN BUTTON -->
  <div class="controls">
    <div class="chip-row">
      <button class="chip" data-n="1">1</button>
      <button class="chip" data-n="5">5</button>
      <button class="chip" data-n="10">10</button>
      <button class="chip" data-n="50">50</button>
      <button class="chip" data-n="250">250</button>
    </div>
    <button id="spin-btn" class="spin-btn">üé∞ –ö—Ä—É—Ç–∏—Ç—å</button>
  </div>

  <!-- HISTORY LOG -->
  <div id="history-log" class="history"></div>

  <!-- MODALS (reward / phrase) --><!-- (–æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π) -->

  <script>
  (function(){
    /* ---------------- STATE ---------------- */
    let balance = 10;
    let isSpinning = false;
    let currentRotation = 0;
    let spinCount = 0;
    const history = [];

    let selectedChip = 1; // default chip value

    /* -------------- HTML REFS -------------- */
    const balanceSpan = document.getElementById('balance');
    const wheel      = document.getElementById('wheel');
    const ball       = document.getElementById('ball');
    const msgBox     = document.getElementById('message');
    const resultBox  = document.getElementById('result-display');
    const historyLog = document.getElementById('history-log');

    /* -------------- INIT ------------------- */
    updateBalance();
    buildWheelNumbers();
    buildBetBoard();
    initChips();
    document.getElementById('spin-btn').addEventListener('click', spin);

    /* ---------- FUNCTIONS ---------- */
    function updateBalance(){
      balanceSpan.textContent = balance;
      localStorage.setItem('bman_balance', balance);
      if(balance >= 1000){ document.getElementById('buy-access').style.display='inline-block'; }
    }

    function buildWheelNumbers(){
      const numbers = Array.from({length:37},(_,i)=>i);
      const colors = ['green', ...numbers.slice(1).map(n=>n%2===0?'black':'red')];
      numbers.forEach((num,i)=>{
        const d=document.createElement('div');
        d.className='wheel-number';
        d.textContent=num;
        d.style.transform=`rotate(${i*(360/37)}deg) translateY(-140px)`;
        d.style.color=colors[i];
        wheel.appendChild(d);
      });
    }

    function buildBetBoard(){
      const board = document.getElementById('bet-board');
      // grid template already in CSS
      const cells=[...Array(37).keys()]; // 0-36
      cells.forEach(n=>{
        const cell=document.createElement('div');
        cell.className='bet-cell';
        cell.dataset.choice=n.toString();
        cell.textContent=n;
        board.appendChild(cell);
      });
      // special cells
      ['red','black','even','odd'].forEach(id=>{
        const cell=document.createElement('div');
        cell.className='bet-cell special';
        cell.dataset.choice=id[0]; // r / b / e / o but we map later
        cell.textContent=id.toUpperCase();
        board.appendChild(cell);
      });
      board.addEventListener('click',e=>{
        const target=e.target.closest('.bet-cell');
        if(!target) return;
        placeMiniChip(target);
      });
    }

    function initChips(){
      document.querySelectorAll('.chip').forEach(btn=>{
        btn.addEventListener('click',()=>{
          document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
          btn.classList.add('active');
          selectedChip=parseInt(btn.dataset.n);
        });
      });
      // activate first chip
      document.querySelector('.chip[data-n="1"]').classList.add('active');
    }

    function placeMiniChip(cell){
      const choice = cell.dataset.choice;
      // toggle highlight
      cell.classList.add('chosen');
      cell.dataset.bet = selectedChip; // store bet amount per cell
      cell.innerHTML = `<span>${choice}</span><div class="mini-chip">${selectedChip}</div>`;
      cell.dataset.choice = choice; // restore text inside span
      // store choice globally (we allow one active choice at a time)
      document.querySelectorAll('.bet-cell').forEach(c=>{
        if(c!==cell){ c.classList.remove('chosen'); delete c.dataset.bet; c.querySelector('.mini-chip')&&c.querySelector('.mini-chip').remove(); }
      });
      resultBox.textContent='';
      msgBox.textContent='–°—Ç–∞–≤–∫–∞: '+selectedChip+' –Ω–∞ '+choice;
    }

    function spin(){
      if(isSpinning) return;
      // get active bet cell
      const active=document.querySelector('.bet-cell.chosen');
      if(!active){ msgBox.textContent='–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–≤–∫—É!'; return; }
      const betAmount=parseInt(active.dataset.bet||0);
      const choiceRaw = active.dataset.choice;
      if(betAmount>balance){ msgBox.textContent='–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ BMAN'; return; }

      /* ----- proceed ----- */
      balance -= betAmount;
      updateBalance();
      isSpinning=true; spinCount++;
      // random outcome
      const resultNum=Math.floor(Math.random()*37);
      animateWheel(resultNum);

      setTimeout(()=>{
        const color = resultNum===0?'green': (resultNum%2===0?'black':'red');
        resultBox.textContent=`–í—ã–ø–∞–ª–æ: ${resultNum} (${color})`;
        const choice = normalizeChoice(choiceRaw);
        let win=0;
        if(matchBet(choice, resultNum, color)){
          win = payoff(choice, betAmount);
        }
        if(win>0){
          balance+=win; msgBox.textContent=`–¢—ã –≤—ã–∏–≥—Ä–∞–ª ${win} BMAN!`;
        } else { msgBox.textContent='–¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.'; }
        logHistory(resultNum,color,win,betAmount);
        updateBalance();
        isSpinning=false;
      },7000);
    }

    /* ---------- Helpers ---------- */
    function normalizeChoice(raw){
      if(raw==='e')return 'xx'; // even
      if(raw==='o')return 'x';  // odd
      return raw;
    }
    function matchBet(choice,num,color){
      switch(choice){
        case 'b': return color==='black';
        case 'r': return color==='red';
        case 'g': return num===0;
        case 'x': return num%2===1;
        case 'xx':return num!==0&&num%2===0;
        default:  return parseInt(choice)===num;
      }
    }
    function payoff(choice,bet){
      return ['g'].includes(choice)?bet*14 : ['b','r','x','xx','e','o'].includes(choice)?bet*2 : bet*36;
    }
    function logHistory(num,color,win,bet){
      const log=`#${spinCount}: ${num} (${color}) ‚Äî ${win>0?'+ '+win:'- '+bet} BMAN`;
      history.unshift(log); if(history.length>10)history.pop();
      historyLog.innerHTML=history.map(h=>`<div>${h}</div>`).join('');
    }

    /* ---------- Wheel + ball animation ---------- */
    function animateWheel(resultNum){
      const sectorAngle=360/37;
      const additionalRot=10*360;
      const stopAngle = (360 - resultNum*sectorAngle + sectorAngle/2);
      currentRotation += additionalRot + stopAngle;
      wheel.style.transition='transform 7s cubic-bezier(0.25,0.1,0.25,1)';
      wheel.style.transform=`rotate(${currentRotation}deg)`;
      // ball opposite dir
      ball.style.transition='transform 7s cubic-bezier(0.25,0.1,0.25,1)';
      ball.style.transform=`rotate(${-currentRotation}deg)`;
    }

  })();
  </script>
</body>
</html>
